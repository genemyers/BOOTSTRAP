<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>SVG- results</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <style>

    .fixed {
      width: 59px;
      height: 55px;
    }

    .edge {
      width: 175px;
      height: 55px;
    }

    .top-cover {
      width: 175px;
      height: 48px;
    }

    .bottom-cover {
      width: 175px; /* 199 */
      height: 38px;
    }

    .pers {
      height: 0px;
      transform: rotateX(90deg);
      animation: top_rp_perspective 2s 1s forwards;
    }

    .pers-front {
      animation: top_rpf_perspective 2s 1s forwards;
    }

    .pers_neg {
      height: 0px;
      transform: rotateX(270deg);
      animation: bottom_rp_perspective 2s 1s forwards;
    }

    .pers_neg-front {
      animation: bottom_rpf_perspective 2s 1s forwards;
    }


    @keyframes top_rp_perspective {
      0%{
        height: 120px;
        transform-origin: bottom;
        perspective-origin: bottom;
        transform: perspective(300px) rotateX(90deg) scale(0.90);
      }
      100% {
        height: 120px;
        transform-origin: bottom;
        perspective-origin: bottom;
        transform: translateY(-26px) perspective(300px) rotateX(-330deg) scale(0.95);
      }
    }

    @keyframes top_rpf_perspective {
      0%{
        transform-origin: top;
        perspective-origin: top;
        transform: perspective(300px) rotateX(0deg);
      }
      100% {
        transform-origin: top;
        perspective-origin: top;
        transform: perspective(300px) rotateX(-30deg);
      }
    }

    @keyframes bottom_rp_perspective {
      0%{
        height: 120px;
        transform-origin: top;
        perspective-origin: top;
        transform: perspective(300px) rotateX(270deg);
      }
      100% {
        height: 120px;
        transform-origin: top;
        perspective-origin: top;
        transform: perspective(300px) rotateX(330deg);
      }
    }

    @keyframes bottom_rpf_perspective {
      0%{
        transform-origin: bottom;
        perspective-origin: bottom;
        transform: perspective(300px) rotateX(0deg);
      }
      100% {
        transform-origin: bottom;
        perspective-origin: bottom;
        transform: perspective(300px) rotateX(30deg);
      }
    }

    </style>
</head>
<body>

  <div class="container-fluid" style="margin-top:400px">

    <div class="row">
      <div class="col"></div>  <!-- centers the comb -->
       <div class="col">

          <div class="row flex-nowrap justify-content-center" id="top-cover">
               <div class="top-cover" style="background-image: url('images/line-drawings/TopCoverLeft.svg');"></div>
               <div id="top-cover-center"></div>
               <div class="top-cover" style="background-image: url('images/line-drawings/TopCoverRight.svg');"></div>
          </div>

      </div> <!-- end of comb column -->
    <div class="col"></div> <!-- centers the comb -->
  </div>  <!-- end of main comb row -->

    <!-- REEDPLATE TOP PERSPECTIVE -->
    <div class="row">
       <div class="col-12">
          <div class="row pers"> <!--  style="margin-left:65px;" -->
            <svg id="mySVGtop-p"  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"></svg>
          </div>
      </div>
    </div>

    <!-- REEDPLATE FRONT -->
    <div class="row">
       <div class="col-12">
          <div class="row pers-front" style="height:10px">
                <svg id="mySVGtop" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"></svg>
          </div>
      </div>
    </div>


    <div class="row">
      <div class="col"></div>  <!-- centers the comb -->
       <div class="col">

         <div class="row flex-nowrap justify-content-center" id="comb">

             <div class="edge" style="background-image: url('images/line-drawings/LeftComb.svg');"></div>
             <!-- CENTERS ADDED DYNAMICALLY -->
             <div class="edge" id="last" style="background-image: url('images/line-drawings/RightComb.svg');"></div>
         </div> <!-- end of row -->

        </div> <!-- end of comb column -->
       <div class="col"></div> <!-- centers the comb -->
      </div>  <!-- end of main comb row -->


      <!-- REEDPLATE FRONT -->
      <div class="row">
         <div class="col-12">
            <div class="row pers_neg-front" style="height:10px">
                  <svg id='mySVGbtm'xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"></svg>
            </div>
        </div>
      </div>

      <!-- REEDPLATE BOTTOM PERSPECTIVE -->
      <div class="row ">
         <div class="col-12">
          <div class="row pers_neg">
            <svg id='mySVGbtm-p'  xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'></svg>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col"></div>  <!-- centers the comb -->
         <div class="col">
            <div class="row flex-nowrap justify-content-center" id="cover">
                   <div class="bottom-cover" style="background-image: url('images/line-drawings/BottomCoverLeft.svg');"></div>
                   <div id="bottom-cover-center"></div>
                   <div class="bottom-cover" style="background-image: url('images/line-drawings/BottomCoverRight.svg');"></div>
            </div>
          </div> <!-- end of comb column -->
        <div class="col"></div> <!-- centers the comb -->
      </div>  <!-- end of main comb row -->

    </div> <!-- end of comb column -->
    <div class="col"></div> <!-- centers the comb -->
  </div>  <!-- end of main comb row -->

  </div>


    <!-- https://stackoverflow.com/questions/21915059/setting-background-image-to-dynamic-svg-data -->

    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <script>

      const params = new Proxy(new URLSearchParams(window.location.search), {
          get: (searchParams, prop) => searchParams.get(prop),
      });

      let numChambers = params.chambers?params.chambers:3;
      console.log(`Number of chambers omn queryString: ${numChambers}`);

      //reeds
      const reedBaseSq = 12;
      const reedWidth = 8;
      const rivetRadius = 3;
      //reed plates
      const height = 120;  //284
      const edge = 110;
      const chamberWidth = 47;

      //comb
      const holeWidth = 59;
      const edgeWidth = 115;

      function createReedplateFace(svg, numHoles) {

          let rp = document.getElementById(svg);
          //width="820" height="10" viewBox="0 0 820 10"
          let width = (edgeWidth * 2) + (numHoles * 59);   //230 + 590
          rp.setAttribute("width", width);
          rp.setAttribute("height", "10");
          rp.setAttribute("viewBox", "0 0 " + width + " 10");

          const newRect = document.createElementNS(
            "http://www.w3.org/2000/svg",
            "rect",
          );

          newRect.setAttribute("x", "0");
          newRect.setAttribute("y", "0");
          newRect.setAttribute("width", width );
          newRect.setAttribute("height", "10");
          newRect.setAttribute("stroke", "black");
          newRect.setAttribute("fill", "transparent");
          newRect.setAttribute("stroke-width", "1");

          rp.appendChild(newRect);

      }

      function createBlowReedplate(svg, numHoles) {

          const svgOld = document.getElementById("dyn");
          //svgOld.remove();

          // create the svg element
          const svg1 = document.createElementNS("http://www.w3.org/2000/svg", "svg");

          let width = ((edge * 2) + ( numHoles * chamberWidth) - chamberWidth + reedBaseSq);

          // set width and height?
          //set viewBox
          svg1.setAttribute("viewBox", "0 0 " + width + " " + height);

          const newRect = document.createElementNS(
            "http://www.w3.org/2000/svg",
            "rect",
          );

          // the plate
          newRect.setAttribute("id", "dyn");
          newRect.setAttribute("x", "0");
          newRect.setAttribute("y", "0");
          newRect.setAttribute("width", width );
          newRect.setAttribute("height", height);
          newRect.setAttribute("stroke", "black");
          newRect.setAttribute("fill", "white");


          svg1.appendChild(newRect);

          document.getElementById(svg).appendChild(svg1);

          let start = edge;


          for (let i = 1; i <= numHoles; i++) {
            console.log(`----${i}----`);
            console.log(`start: ${start}`);
            createBlowReed(svg,svg1,i,numHoles, start);
            start += chamberWidth;
            console.log(`chamberWidth: ${chamberWidth} start: ${start}`);
          }


       }



       function createBlowReed(svg,svg1, holeNum, numHoles, start) {

          const b_reed = document.createElementNS(
            "http://www.w3.org/2000/svg",
            "rect",
          );
          // create a circle
          const rivet = document.createElementNS(
            "http://www.w3.org/2000/svg",
            "circle",
          );

          b_reed.setAttribute("x",  start + 2);      //(holeNum * 32) + 23 + 2 ); //57 - 2 is the reed base offset, 23 is the margin offset, 32 is the chamber width
          b_reed.setAttribute("y", 8 + (height/4) - ( 0 - (((height/4)/numHoles) * holeNum))); //38  96-38    120-60-12-10  width of plate - len of reed - base - 10
          b_reed.setAttribute("width", reedWidth);
          b_reed.setAttribute("height", ((height/2)) - (((height/4)/numHoles) * holeNum));
          b_reed.setAttribute("stroke", "black");
          b_reed.setAttribute("fill", "white");



          rivet.setAttribute("cx", start + 6); //(holeNum * 32) + 23 + 6 ); //61 - 6 is the reed base offset, 23 is the margin offset, 32 is the chamber width-  to the center
          rivet.setAttribute("cy", "104"); //120-6- 10     width of plate - 1/2 of base  to center of circle
          rivet.setAttribute("r", rivetRadius);
          rivet.setAttribute("stroke", "black");
          rivet.setAttribute("fill", "white");


          // attach it to the container
          //svg1.appendChild(newRect);
          svg1.appendChild(b_reed);
          //svg1.appendChild(base);
          svg1.appendChild(rivet);

          // attach container to document
          document.getElementById(svg).appendChild(svg1);

      }



      function createDrawReedplate(svg, numHoles) {


          // create the svg element
          const svg1 = document.createElementNS("http://www.w3.org/2000/svg", "svg");

          let width = ((edge * 2) + ( numHoles * chamberWidth) - chamberWidth + reedBaseSq);

          // set width and height?
          //set viewBox
          svg1.setAttribute("viewBox", "0 0 " + width + " " + height);

          const newRect = document.createElementNS(
            "http://www.w3.org/2000/svg",
            "rect",
          );

            // the plate
            newRect.setAttribute("x", "0");
            newRect.setAttribute("y", "0");
            newRect.setAttribute("width", width);
            newRect.setAttribute("height", height);
            newRect.setAttribute("stroke", "black");
            newRect.setAttribute("fill", "white");

          svg1.appendChild(newRect);

          document.getElementById(svg).appendChild(svg1);


          // for (let i = 1; i <= numHoles; i++) {
          //   createDrawReed(svg,svg1,i,numHoles);
          // }

          let start = edge;
          //let chamberWidth = (width - (start+(start/2))-4)/numHoles;

          for (let i = 1; i <= numHoles; i++) {
            console.log(`----${i}----`);
            console.log(`start: ${start}`);
            createDrawReed(svg,svg1,i,numHoles, start);
            start += chamberWidth;
            console.log(`chamberWidth: ${chamberWidth} start: ${start}`);
          }
      }

      function createDrawReed(svg, svg1, holeNum, numHoles, start) {

        const b_reed = document.createElementNS(
          "http://www.w3.org/2000/svg",
          "rect",
        );

        const base = document.createElementNS(
          "http://www.w3.org/2000/svg",
          "rect",
        );


        //the reed
        b_reed.setAttribute("x", start + 2);//(holeNum * 32) + 23 + 2 ); //57 - 2 is the reed base offset, 23 is the margin offset, 32 is the chamber width
        b_reed.setAttribute("y", "22"); // base + 10
        b_reed.setAttribute("width", reedWidth);
        b_reed.setAttribute("height",  60 - ((30/numHoles) * holeNum) ); // 60 30/10 = 3  63 - 3 = 60   63 - 30 = 33    60 - ()(30/numHoles) * holeNum) = 1.5 *
        b_reed.setAttribute("stroke", "black");
        b_reed.setAttribute("fill", "white");

        //the reed base
        base.setAttribute("x", start);//(holeNum * 32) + 23 ); //55 - no reed base offset, 23 is the margin offset, 32 is the chamber width-  //we base the left side on the firstest point left- the reed base
        base.setAttribute("y", 80 + ( 0 - ((30/numHoles) * holeNum))); //80
        base.setAttribute("width", reedBaseSq);
        base.setAttribute("height", reedBaseSq);
        base.setAttribute("stroke", "black");
        base.setAttribute("fill", "white");

        // create a circle
        const rivet = document.createElementNS(
          "http://www.w3.org/2000/svg",
          "circle",
        );
        rivet.setAttribute("cx", start + 6); //(holeNum * 32) + 23 + 6 ); //61 - 6 is the reed offset, 23 is the margin offset, 32 is the chamber width-  to the center
        rivet.setAttribute("cy", 86 + ( 0 - ((30/numHoles) * holeNum))); //120-4-20 to center of circle
        rivet.setAttribute("r", rivetRadius);
        rivet.setAttribute("stroke", "black");
        rivet.setAttribute("fill", "white");


        // attach it to the container
        //svg1.appendChild(newRect);
        svg1.appendChild(b_reed);
        svg1.appendChild(base);
        svg1.appendChild(rivet);

        // attach container to document
        document.getElementById(svg).appendChild(svg1);
      }



      function renderComb(numChambers) {

        numChambers -= 2; //substrace the left and right edges
        const parent = document.getElementById("comb");
        const last = document.getElementById("last");
        for (let x = 0; x < numChambers; x++) {
          var centerComb = document.createElement('div');
          centerComb.setAttribute("class", "fixed");
          centerComb.setAttribute("style","background-image: url('images/line-drawings/CenterComb.svg')");
          //<div class="fixed" style="background-image: url('images/line-drawings/CenterComb.svg');"></div>
          parent.insertBefore(centerComb, last)
        }
      }

      function sizeCover(numChambers,elementId) {
        numChambers -= 2; //compensate for left and right homes
        const center = document.getElementById(elementId);
        center.setAttribute(`style`,`width:${numChambers*59}px;background-image: url('images/line-drawings/TopCoverCenter.svg')`);
      }

      function renderHarp(numChambers) {
        sizeCover(numChambers,"top-cover-center");
        createBlowReedplate("mySVGtop-p", numChambers);
        createReedplateFace("mySVGtop", numChambers);
        renderComb(numChambers);
        createReedplateFace("mySVGbtm", numChambers);
        createDrawReedplate("mySVGbtm-p", numChambers);
        sizeCover(numChambers,"bottom-cover-center");
      }

      renderHarp(numChambers);



    </script>
</body>
</html>
